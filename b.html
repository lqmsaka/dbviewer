<!DOCTYPE html>
<html>
<head>
	<title></title>
	<!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

	<link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.15.3/dist/bootstrap-table.min.css">

	<style type="text/css">
		html,body,.container-flued {height: 100%};
		.table-area{width: 200px}
	</style>
</head>
<body>
	<div class="container-flued">
		<div class="row" style="height: 100%;width: 100%">
			<div class="col-xs-3" style="height: 100%;position: fixed;">
				<table id='list'></table>
			</div>
			<div class="col-xs-9 col-xs-offset-3" style="height: 100%">
			<div class="row">
				<button onclick="search()">Search</button>
			</div>
			<div class="row" style="height: 30%;overflow: overlay">
				<div id="ts"></div>
			</div>
			<div class="row">
				<table id="detail"></table>
			</div>
			</div>
		</div>
	</div>

    <!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
    <!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/bootstrap-table@1.15.3/dist/bootstrap-table.min.js"></script>
    <script>
    	$(function(){
    		$('#list').bootstrapTable({
			  url:"tablelist.json",
			  columns: [{
			    checkbox: true
			  }, {
			    field: 'tablename',
			    title: '表名'
			  }],
			  onCheck:function(row,$elem){
			  	table(row.tablename);
			  },
			  onUncheck:function (row,$elem) {
			  	remove(row.tablename);
			  }
			});

			//table("table1");
    	})

    	function table(name){
    		var panel = $("#ts");
    		var t = panel.find(`#${name}`);
    		panel.append(`<div class="col-xs-4"><div>`).children("div:last").append(`<table id='${name}'></table>`);
    		t = $(`#${name}`);
    		t.bootstrapTable({
    			url:`${name}.json`,
    			columns:[
	    			{
	    				checkbox:true
	    			},{
	    				field:"name",
	    				title:name
	    			},{
	    				field:"disp",
	    				title:""//"显示名称"
	    			},{
	    				field:"filter",
	    				title:"条件"
	    			}
    			],
				toolbar:`<button onclick='removeSelf("${name}")'>移除</button>`,
				//showHeader:false
    		})
    	}

    	function remove(name){
		  	$(`#${name}`).parents(".bootstrap-table:first").parent().remove();

    	}

    	function removeSelf(name){
		  	$("#list").bootstrapTable("uncheckBy",{field:'tablename',values:name});
    	}

    	function search(){
    		let list = $("#ts").find("table.table")
    		let cond = [];
    		for(let i =0;i <list.length;i++){
    			let table = list[i];
    			let rows = $(table).bootstrapTable('getSelections');
    			let t = {};
    			t.name = table.id;
    			t.cond = [];
    			for(let j=0;j<rows.length;j++){
    				let row = rows[j];
    				t.cond.push(row.name)
    			}
    			cond.push(t);
    		}
    		showdetail(cond);
    	}
    	function showdetail(cond){

			$("#detail").bootstrapTable({
				columns:[
					{
						field: 'ID',
						title: 'ID'
					},{
						field: 'OPER_TYPE',
						title: '操作类型',
						sortable:true
					},{
						field: 'OPER_CMD',
						title: '操作命令'
					},{
						field: 'TABLE_NAME',
						title: '涉及数据'
					},{
						field: 'OPER_PARAM',
						title: '操作参数'
					},{
						field: 'START_TIME',
						title: '开始时间'
					},{
						field: 'END_TIME',
						title: '结束时间'
					},{
						field: 'AFFECT_ROWS',
						title: '影响记录'
					},{
						field: 'IS_SUCESS',
						title: '成功标志'
					},{
						field: 'ERROR_INFO',
						title: '错误信息'
					},{
						field: 'OPER_MAN',
						title: '操作人'
					},{
						field: 'OPER_MAN_ID',
						title: '操作人id'
					},{
						field: 'AFFECT_ROWS2',
						title: '涉及记录'
					},{
						field: 'JOB_START_DATE',
						title: '任务开始日期'
					}
				],
				showColumns:true
			})
    	}
    </script>
</body>
</html>